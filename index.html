<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Retrocards</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="intro-banner">
    <h2>Upload a photo. Pick your world. Customize your alter ego.</h2>
    <p>Retrocards combines you with the raw essence of your favorite retro characters.</p>
  </header>

  <div class="container">
    <h1>Retrocards</h1>
    <form id="customizer-form">
      <label for="imageUpload">Upload Your Photo</label>
      <input type="file" id="imageUpload" accept="image/*" />
      <div id="preview"></div>

      <div id="spinner" style="display: none; text-align: center; margin-top: 1rem;">
        <p>Generating image...</p>
        <div class="loader"></div>
      </div>

      <label>Select Your Character Style</label>
      <div class="template-options">
        <div class="template" data-character="Grendals">
          <img src="templates/grendals-thumb.png.jfif" alt="Grendals" />
          <p>Grendals</p>
          <small>Don't get them wet. Don't expose them to phone light. Don't feed them after midnight.</small>
        </div>
        <div class="template" data-character="Operation Bravo">
          <img src="templates/operation-bravo-thumb.png.PNG" alt="Operation Bravo" />
          <p>Operation Bravo</p>
          <small>Put the action back in action hero!</small>
        </div>
        <div class="template" data-character="Trash Can Kids">
          <img src="templates/slop-squad-thumb.png.png" alt="Trash Can Kids" />
          <p>Trash Can Kids</p>
          <small>Disgustingly Disturbing</small>
        </div>
      </div>

      <div id="custom-inputs" class="custom-inputs hidden">
        <div class="input-block" id="block-dominantTrait">
          <label>Dominant Trait (Grendals)</label>
          <input type="text" id="dominantTrait" placeholder="e.g. slimy" />
        </div>
        <div class="input-block" id="block-visualStyle">
          <label>Visual Style (Grendals)</label>
          <input type="text" id="visualStyle" placeholder="e.g. punk" />
        </div>
        <!-- Operation Bravo and Trash Can Kids can be added here -->
      </div>

      <button type="submit">Generate Character</button>
    </form>

    <div id="output" class="output hidden">
      <div id="card-image"></div>
      <div id="card-overlay">
        <h2 id="cardName"></h2>
        <p><strong>Grendal Level:</strong> <span id="grendalLevel"></span></p>
        <p id="backstory"></p>
      </div>
    </div>
  </div>

  <script>
    document.querySelectorAll(".template").forEach((template) => {
      template.addEventListener("click", function () {
        document.querySelectorAll(".template").forEach((el) => el.classList.remove("selected"));
        this.classList.add("selected");

        const inputBlock = document.getElementById("custom-inputs");
        const selectedChar = this.dataset.character;
        inputBlock.classList.remove("hidden");

        document.querySelectorAll(".input-block").forEach(b => b.style.display = "none");

        if (selectedChar === "Grendals") {
          ["dominantTrait", "visualStyle"].forEach(id => {
            document.getElementById("block-" + id).style.display = "block";
          });
        }
      });
    });

    document.getElementById("customizer-form").addEventListener("submit", async function (e) {
      e.preventDefault();

      const selected = document.querySelector(".template.selected");
      const uploadedFile = document.getElementById("imageUpload").files[0];

      if (!selected || !uploadedFile) {
        alert("Please upload a photo and select a template.");
        return;
      }

      const formData = new FormData();
      formData.append("photo", uploadedFile);
      formData.append("character", selected.dataset.character);
      ["dominantTrait", "visualStyle"].forEach(id => {
        const val = document.getElementById(id).value.trim();
        if (val) formData.append(id, val);
      });

      document.getElementById("spinner").style.display = "block";
      document.getElementById("output").classList.add("hidden");

      try {
        const response = await fetch("https://retrocardtest.onrender.com/generate", {
          method: "POST",
          body: formData
        });

        const data = await response.json();
        document.getElementById("spinner").style.display = "none";

        if (data.imageUrl) {
          document.getElementById("card-image").innerHTML = `<img src="${data.imageUrl}" alt="Generated Card" />`;
          document.getElementById("cardName").textContent = data.cardName;
          document.getElementById("grendalLevel").textContent = data.grendalLevel || "-";
          document.getElementById("backstory").textContent = data.backstory || "";
          document.getElementById("output").classList.remove("hidden");
        } else {
          alert("Image generation failed.");
        }
      } catch (err) {
        console.error("‚ùå Error:", err);
        alert("Something went wrong generating the image.");
        document.getElementById("spinner").style.display = "none";
      }
    });
  </script>
</body>
</html>
